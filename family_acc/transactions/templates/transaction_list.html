{% extends "layout.html" %}
{% load i18n %}

{% block title %}
    {% trans "Transactions" %}
{% endblock %}

{% block content %}
<div>
    <h1>{% trans "Transactions" %}</h1>
    <form method="get">
        <label>{% trans "From" %}: <input type="date" name="start" value="{{request.GET.start}}"></label>
        <label>{% trans "To" %}: <input type="date" name="end" value="{{request.GET.end}}"></label>
        <button type="form-submit">{% trans "Filter" %}</button>
        <a href="?start={{request.GET.start}}&end={{request.GET.end}}&export=csv">{% trans "Download CSV" %}</a>
    </form>
    <br>
    <div>{% trans "Report period" %}: {{start}} ... {{end}}</b></div>

    <form method="post" onsubmit="return confirm('Are you sure you want to delete the selected transactions?');">
        {% csrf_token %}

        <table>
            <tr>
                <th><input type="checkbox" id="select-all"></th>
                <th> {% trans "Date" %}  </th>
                <th> {% trans "Account" %}  </th>
                <th> {% trans "Amount" %}  </th>
                <th> {% trans "Currency" %}  </th>
                <th> {% trans "Category" %} </th>
            </tr>
            {% for item in data%}
                <tr class="{% if item.amount > 0 %}income{% else %}expense{% endif %}">
                    <td> <input type="checkbox" name="ids" value="{{ item.id }}" class="select-row"> </td>
                    <td> <a href="transaction_edit/{{item.id}}" title="push to edit"> {{item.date|date:"d-m-Y"}} </a></td>
                    <td> {{item.account}} </td>
                    <td> {{item.amount}} </td>
                    <td> {{item.currency}} </td>
                    <td> {{item.category}} </td>
                </tr>
            {% endfor %}
        </table>  
        <script>
            const selectAll = document.getElementById('select-all');
            const checkboxes = document.querySelectorAll('.select-row');

            selectAll.addEventListener('change', function() {
                checkboxes.forEach(cb => cb.checked = selectAll.checked);
            });
        </script>
        <button type="submit" name="action" value="delete">{% trans "Delete selected" %}</button>
    </form>
</div>
{% endblock %}